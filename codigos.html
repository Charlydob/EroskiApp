<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Inicio</title>
    <link rel="stylesheet" href="styles/style.css" />
    <link rel="stylesheet" href="styles/codigos.css" />
    <script src="navbar.js"></script>

    <script src="scripts/proteccion.js"></script>
    <!-- Resaltado del enlace activo  en el navbar -->
    <script>
    window.onload = () => {
        const links = document.querySelectorAll('.sidebar a');
        links.forEach(link => {
        if (link.href === window.location.href) {
            link.classList.add('active');
        }
        });
    };
    </script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDN8KAiad5vmKNwhtfd9EUzVgTt2uUapno",
    authDomain: "eroskiapp.firebaseapp.com",
    databaseURL: "https://eroskiapp-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "eroskiapp",
    storageBucket: "eroskiapp.appspot.com",
    messagingSenderId: "1033463841470",
    appId: "1:1033463841470:web:ec92569dd7dabe8a93d4ef"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

   // TEST DE CONEXIÃ“N
  db.ref().once("value")
    .then(snapshot => {
      console.log("ğŸ”¥ Firebase raÃ­z:", snapshot.val());
    })
    .catch(err => {
      console.error("âŒ Error al conectar con Firebase:", err);
    });
</script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-storage-compat.js"></script>

</head>
<body>
  <div class="container">
    <nav class="sidebar">
        <h2 class="logo">Mi Web</h2>
             <a href="index.html"><img src="recursos/img/iniciologo.png" alt="Inicio" class="icon" /></a>
        <a href="balanza.html"><img src="recursos/img/balanzalogo.png" alt="Balanza" class="icon" /></a>
        <a href="checklist.html"><img src="recursos/img/Checklist.png" alt="Checklist" class="icon" /></a>
        <a href="calendario.html"><img src="recursos/img/imagenes.png" alt="Calendario" class="icon" /></a>
        <a href="codigos.html"><img src="recursos/img/codigos.png" alt="CÃ³digos" class="icon" /></a>
        <a href="tpv.html"><img src="recursos/img/tpv.png" alt="tpv" class="icon" /></a>
        <a href="horarios.html"><img src="recursos/img/calendario.png" alt="Horarios" class="icon" /></a>
    </nav>

    <main class="content">
      <h1>ğŸ” CÃ³digos de balanzas</h1>
      <div class="filtros-rapidos">
        <button id="btn-merma">Merma</button>
        <button id="btn-envasar">Envasar</button>
        <button id="btn-caja">Caja</button>
        <button id="btn-previa">Previa</button>
        <button id="btn-tele">Tele-Recarga</button>

  <button id="btn-sumar" style="display: none;">â•</button>
  <button id="btn-restar" style="display: none;">â–</button>

      </div>
<div id="selectores">
      <input type="text" id="buscador" placeholder="Buscar producto..." />
      <select id="filtro-categoria">
  <option value="">Todas las categorÃ­as</option>
  <option value="fruta">Fruta</option>
  <option value="bolleria">Bolleria</option>
  <option value="pan">Pan</option>
  <!-- AÃ±ade mÃ¡s si las tienes -->
</select>
<button id="btn-nuevo" style="margin: 1rem 0;">â• AÃ±adir producto</button>
<button onclick="iniciarEscaneo()">ğŸ“· Escanear CÃ³digo</button>

</div>
      <div id="galeria" class="galeria"></div>
    </main>
  </div>
  <div id="modal-edicion" class="modal oculto">
  <div class="modal-contenido">
    <h3>Editar producto</h3>
    <div class="form-grid">
  <div class="campo">
    <input id="edit-nombre" type="text" placeholder="Nombre" />
  </div>
  <div class="campo">
    <input id="edit-balanza" type="number" inputmode="numeric" placeholder="CÃ³digo balanza" />
  </div>
  <div class="campo">
    <input id="edit-merma" type="number" inputmode="numeric" placeholder="CÃ³digo merma" />
  </div>
  <div class="campo">
    <input id="edit-ref" type="number" inputmode="numeric" placeholder="Referencia" />
  </div>
  <div class="campo">
    <select id="edit-cat">
      <option value="" disabled selected>Selecciona una categorÃ­a</option>
      <option value="fruta">Fruta</option>
      <option value="bolleria">Bolleria</option>
      <option value="pan">Pan</option>
      <option value="tele-recarga">Tele-Recarga</option>

    </select>
</div>
    <div class="acciones">
  <button id="guardar-edicion">ğŸ’¾</button>
  <button id="toggle-visible">ğŸ”’</button>
  <button id="btn-eliminar" class="eliminar">ğŸ—‘ï¸</button>
  <button onclick="cerrarModalEdicion()">âŒ</button>
</div>

  </div>
</div>


  <script src="scripts/codigos.js"></script>
<div id="lector-wrapper" style="position: relative; display: none; margin-top: 1rem;">
  <button onclick="cerrarEscaner()" style="
    position: absolute;
    top: -10px;
    right: -10px;
    z-index: 1000;
    background: red;
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    font-size: 18px;
    cursor: pointer;
  ">âŒ</button>

  <div id="lector-codigos" style="width: 100%; max-width: 350px; border: 2px dashed #aaa;"></div>
</div>

<button onclick="iniciarEscaneo()">ğŸ“· Escanear CÃ³digo</button>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
  let escaner = null;

  function iniciarEscaneo() {
    const wrapper = document.getElementById("lector-wrapper");
    wrapper.style.display = "block";

    if (escaner) return;

    escaner = new Html5Qrcode("lector-codigos");

    escaner.start(
      { facingMode: "environment" },
      {
        fps: 10,
        qrbox: 250,
        formatsToSupport: [
          Html5QrcodeSupportedFormats.QR_CODE,
          Html5QrcodeSupportedFormats.EAN_13,
          Html5QrcodeSupportedFormats.UPC_A,
          Html5QrcodeSupportedFormats.CODE_128
        ]
      },
      (code) => {
        console.log("ğŸ“¦ CÃ³digo detectado:", code);

        document.getElementById("buscador").value = code;
        document.getElementById("buscador").dispatchEvent(new Event("input"));

        cerrarEscaner(); // parar despuÃ©s de leer
      },
      (errorMsg) => {
        // console.warn("Error escaneo:", errorMsg);
      }
    ).catch(err => {
      console.error("âŒ Error al iniciar escaneo:", err);
      cerrarEscaner();
    });
  }

  function cerrarEscaner() {
    const wrapper = document.getElementById("lector-wrapper");
    wrapper.style.display = "none";

    if (escaner) {
      escaner.stop().then(() => {
        escaner.clear();
        escaner = null;
      }).catch(err => {
        console.error("âŒ Error al detener escÃ¡ner:", err);
      });
    }
  }
</script>






</body>

</html>
